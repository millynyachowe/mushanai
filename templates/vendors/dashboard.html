{% extends 'base.html' %}

{% block title %}Vendor Dashboard - Mushanai{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="page-header">
        <div class="text-center">
            <h1 class="page-title">
                Dashboard
            </h1>
        </div>
    </div>
    
<div class="container">
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-value">{{ total_products }}</div>
            <div class="stat-card-label">Total Products</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-card-value">{{ active_products }}</div>
            <div class="stat-card-label">Active Products</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-card-value">{{ total_clicks }}</div>
            <div class="stat-card-label">Total Clicks</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-card-value">{{ abandoned_carts_count }}</div>
            <div class="stat-card-label">Abandoned Carts</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-card-value">${{ total_revenue|floatformat:2 }}</div>
            <div class="stat-card-label">Total Revenue</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-card-value">{{ total_orders }}</div>
            <div class="stat-card-label">Total Orders</div>
        </div>
    </div>
    
    {% if selected_project %}
    <div class="card" style="margin-bottom: 2rem; background-color: #f8f8f8;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="margin-bottom: 0.5rem; color: #000000;">Selected Project for Customer Contributions</h3>
                <p style="color: #666; margin-bottom: 0.5rem;">
                    <strong>{{ selected_project.title }}</strong> - 
                    {{ selected_project.funding_percentage|floatformat:1 }}% funded
                </p>
                <p style="color: #666; font-size: 0.9rem;">
                    Customer purchases will contribute to this project. 
                    <a href="{% url 'project_detail' selected_project.slug %}" style="color: #be8400;">View project details</a>
                </p>
            </div>
            <div style="width: 100px; height: 100px; border-radius: 8px; overflow: hidden; margin-left: 1rem;">
                {% if selected_project.image %}
                    <img src="{{ selected_project.image.url }}" alt="{{ selected_project.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                    <div style="width: 100%; height: 100%; background-color: #e0e0e0; display: flex; align-items: center; justify-content: center; color: #999;">
                        No Image
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Reviews Summary -->
    {% if pending_reviews_count > 0 or reviews_needing_response > 0 %}
    <div class="card" style="margin-bottom: 2rem; background-color: #fff3cd; border: 2px solid #ffc107;">
        <div class="card-header" style="color: #856404;">Review Alerts</div>
        <div style="padding: 1rem;">
            {% if pending_reviews_count > 0 %}
            <p style="margin: 0.5rem 0; color: #856404;">
                <strong>{{ pending_reviews_count }}</strong> review{{ pending_reviews_count|pluralize }} pending approval.
            </p>
            {% endif %}
            {% if reviews_needing_response > 0 %}
            <p style="margin: 0.5rem 0; color: #856404;">
                <strong>{{ reviews_needing_response }}</strong> review{{ reviews_needing_response|pluralize }} need{{ reviews_needing_response|pluralize:",s" }} your response.
            </p>
            {% endif %}
            <a href="{% url 'vendor_reviews' %}" class="btn btn-primary" style="margin-top: 0.5rem; background-color: #be8400;">Manage Reviews</a>
        </div>
    </div>
    {% endif %}
    
    <!-- Vendor Rating & Badges -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-header">Vendor Rating & Badges</div>
        <div style="padding: 1.5rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
                <!-- Rating -->
                <div style="text-align: center;">
                    <div style="font-size: 3rem; color: #be8400; font-weight: bold; margin-bottom: 0.5rem;">
                        {% if vendor_profile.overall_rating > 0 %}
                            {{ vendor_profile.overall_rating|floatformat:1 }}
                        {% else %}
                            N/A
                        {% endif %}
                    </div>
                    <div style="color: #666; margin-bottom: 0.5rem;">Overall Rating</div>
                    <div style="color: #666; font-size: 0.9rem;">{{ vendor_profile.total_reviews }} review{{ vendor_profile.total_reviews|pluralize }}</div>
                </div>
                
                <!-- Response Time -->
                <div style="text-align: center;">
                    <div style="font-size: 2rem; color: #17a2b8; font-weight: bold; margin-bottom: 0.5rem;">
                        {% if vendor_profile.average_response_time_hours %}
                            {{ vendor_profile.response_time_display }}
                        {% else %}
                            N/A
                        {% endif %}
                    </div>
                    <div style="color: #666; margin-bottom: 0.5rem;">Avg Response Time</div>
                    <div style="color: #666; font-size: 0.9rem;">To customer reviews</div>
                </div>
            </div>
            
            <!-- Badges -->
            {% if vendor_profile.badges.exists %}
            <div style="border-top: 1px solid #e0e0e0; padding-top: 1rem;">
                <h4 style="margin-bottom: 1rem; color: #000000;">Your Badges</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
                    {% for badge in vendor_profile.badges.all %}
                    <div style="display: flex; align-items: center; gap: 0.5rem; background-color: #f8f8f8; padding: 0.75rem; border-radius: 8px; border: 2px solid {{ badge.color }};">
                        <span style="font-size: 1.5rem;">{% if badge.icon %}{{ badge.icon }}{% else %}üèÖ{% endif %}</span>
                        <div>
                            <div style="font-weight: bold; color: #000000;">{{ badge.name }}</div>
                            <div style="font-size: 0.85rem; color: #666;">{{ badge.description }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div style="border-top: 1px solid #e0e0e0; padding-top: 1rem;">
                <p style="color: #666; text-align: center; margin: 0;">No badges yet. Keep up the great work to earn badges!</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- App Icons Section -->
    <div class="app-grid-container">
        <div class="app-grid">
            <!-- Products -->
            <div class="app-item">
                <a href="{% url 'vendor_product_list' %}" class="app-link">
                    <div class="app-icon products-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <span class="app-name">Products</span>
                    <span class="app-info" title="Manage your product catalogue and add new items">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- POS -->
            <div class="app-item">
                <a href="{% url 'vendor_pos' %}" class="app-link">
                    <div class="app-icon pos-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <span class="app-name">POS</span>
                    <span class="app-info" title="Record in-person sales and generate receipts">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Accounting -->
            <div class="app-item">
                <a href="{% url 'vendor_accounting_dashboard' %}" class="app-link">
                    <div class="app-icon accounting-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <span class="app-name">Accounting</span>
                    <span class="app-info" title="Track expenses, revenue, and financial reports">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Expenses -->
            <div class="app-item">
                <a href="{% url 'vendor_expenses_list' %}" class="app-link">
                    <div class="app-icon expenses-icon">
                        <i class="fas fa-receipt"></i>
                    </div>
                    <span class="app-name">Expenses</span>
                    <span class="app-info" title="Record and categorize business expenses">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Manufacturing -->
            <div class="app-item">
                <a href="{% url 'manufacturing_dashboard' %}" class="app-link">
                    <div class="app-icon manufacturing-icon">
                        <i class="fas fa-industry"></i>
                    </div>
                    <span class="app-name">Manufacturing</span>
                    <span class="app-info" title="Manage production orders and bills of materials">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Receipts -->
            <div class="app-item">
                <a href="{% url 'vendor_receipts_list' %}" class="app-link">
                    <div class="app-icon receipts-icon">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <span class="app-name">Receipts</span>
                    <span class="app-info" title="View and manage all sales receipts">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Analytics -->
            <div class="app-item">
                <a href="{% url 'vendor_analytics_dashboard' %}" class="app-link">
                    <div class="app-icon analytics-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <span class="app-name">Analytics</span>
                    <span class="app-info" title="View sales performance and business insights">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Reviews -->
            <div class="app-item">
                <a href="{% url 'vendor_reviews' %}" class="app-link">
                    <div class="app-icon reviews-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <span class="app-name">Reviews</span>
                    <span class="app-info" title="Manage and respond to customer reviews">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Payments -->
            <div class="app-item">
                <a href="{% url 'vendor_payment_inbox' %}" class="app-link">
                    <div class="app-icon payments-icon">
                        <i class="fas fa-money-check-alt"></i>
                    </div>
                    <span class="app-name">Payments</span>
                    <span class="app-info" title="Review payment proofs and acknowledge orders">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>

            <!-- Settings -->
            <div class="app-item">
                <a href="{% url 'vendor_profile' %}" class="app-link">
                    <div class="app-icon settings-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <span class="app-name">Settings</span>
                    <span class="app-info" title="Update profile, payment methods, and delivery settings">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </a>
            </div>
        </div>
    </div>
    
    {% if upcoming_events %}
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-header">Upcoming Events for You</div>
        <div style="padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem;">
            {% for event in upcoming_events %}
            <div style="border: 1px solid #e0e0e0; border-radius: 12px; overflow: hidden; background-color: #fdfdfd;">
                {% if event.image %}
                <div style="height: 160px; overflow: hidden;">
                    <img src="{{ event.image.url }}" alt="{{ event.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                {% endif %}
                <div style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="margin: 0; font-size: 1.1rem; color: #000000;">{{ event.title }}</h3>
                        {% if not event.is_global %}
                        <span style="font-size: 0.75rem; background-color: #e8f4ff; color: #0d47a1; padding: 0.2rem 0.6rem; border-radius: 999px;">Invited</span>
                        {% endif %}
                    </div>
                    <p style="color: #666; font-size: 0.9rem; margin: 0.4rem 0;">
                        {{ event.location }}<br>
                        {{ event.start_datetime|date:"M d, Y @ H:i" }}
                        {% if event.end_datetime %} - {{ event.end_datetime|date:"H:i" }}{% endif %}
                    </p>
                    {% if event.description %}
                    <p style="color: #555; font-size: 0.9rem; margin-bottom: 0.8rem;">{{ event.description|truncatewords:25 }}</p>
                    {% endif %}
                    <div style="display: flex; flex-direction: column; gap: 0.4rem; font-size: 0.9rem; color: #333;">
                        {% if event.price %}
                        <div><strong>Price:</strong> ${{ event.price }}</div>
                        {% endif %}
                        {% if event.early_bird_price %}
                        <div><strong>Early Bird:</strong> ${{ event.early_bird_price }} until {{ event.early_bird_deadline|date:"M d, Y" }}</div>
                        {% endif %}
                        {% if event.payment_methods %}
                        <div>
                            <strong>Payment:</strong>
                            <span>
                                {% for method in event.payment_methods_display %}
                                    <span style="display: inline-block; background-color: #f0f0f0; padding: 0.2rem 0.5rem; border-radius: 999px; font-size: 0.8rem; margin-right: 0.3rem;">
                                        {{ method }}
                                    </span>
                                {% endfor %}
                            </span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div class="card">
        <div class="card-header">Recent Products</div>
        {% if products %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid #e0e0e0;">
                    <th style="padding: 1rem; text-align: left;">Product</th>
                    <th style="padding: 1rem; text-align: left;">Price</th>
                    <th style="padding: 1rem; text-align: left;">Status</th>
                    <th style="padding: 1rem; text-align: left;">Clicks</th>
                    <th style="padding: 1rem; text-align: left;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr style="border-bottom: 1px solid #e0e0e0;">
                    <td style="padding: 1rem;">
                        <strong>{{ product.name }}</strong>
                    </td>
                    <td style="padding: 1rem;">${{ product.price }}</td>
                    <td style="padding: 1rem;">
                        {% if product.is_active %}
                            <span style="color: green;">Active</span>
                        {% else %}
                            <span style="color: red;">Inactive</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem;">{{ product.search_count }}</td>
                    <td style="padding: 1rem;">
                        <a href="{% url 'vendor_product_detail' product.pk %}" style="color: #be8400; text-decoration: none;">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="text-align: center; color: #666; padding: 2rem;">No products yet. <a href="{% url 'vendor_product_create' %}" style="color: #be8400;">Create your first product</a></p>
        {% endif %}
    </div>
    
    <!-- Recent Reviews -->
    {% if recent_reviews %}
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">Recent Reviews</div>
        <div style="padding: 1rem;">
            {% for review in recent_reviews %}
            <div style="padding: 1rem; border-bottom: 1px solid #e0e0e0; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 0.5rem; color: #000000;">
                            <a href="{% url 'product_detail' review.product.slug %}" style="color: #be8400; text-decoration: none;">{{ review.product.name }}</a>
                        </h4>
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                            <span style="color: #be8400;">‚≠ê</span>
                            <span>{{ review.rating }} stars</span>
                            <span style="color: #666;">by {{ review.customer.username }}</span>
                            {% if review.is_verified_purchase %}
                            <span style="background-color: #be8400; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">‚úì Verified</span>
                            {% endif %}
                            {% if not review.is_approved %}
                            <span style="background-color: #ffc107; color: #000; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Pending</span>
                            {% endif %}
                        </div>
                        {% if review.title %}
                        <h5 style="margin: 0.5rem 0; color: #000000;">{{ review.title }}</h5>
                        {% endif %}
                        <p style="color: #666; margin: 0.5rem 0; font-size: 0.9rem;">{{ review.comment|truncatewords:30 }}</p>
                        {% if review.vendor_response %}
                        <p style="color: #be8400; font-size: 0.9rem; margin-top: 0.5rem;">‚úì You responded to this review</p>
                        {% elif review.is_approved %}
                        <a href="{% url 'vendor_reviews' %}?status=not_responded" style="color: #be8400; font-size: 0.9rem;">Respond to this review ‚Üí</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="{% url 'vendor_reviews' %}" class="btn btn-outline">View All Reviews</a>
            </div>
        </div>
    </div>
    {% endif %}
</div>
</div>

<style>
/* Page Header Styles */
.page-header {
    padding: 2rem 0;
    margin-bottom: 2rem;
}

.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #000;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 0;
}

.text-primary {
    color: #be8400 !important;
}


/* App Grid Styles */
.app-grid-container {
    display: flex;
    justify-content: center;
    padding: 0 15px;
    margin-bottom: 40px;
}

.app-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 30px;
    max-width: 1000px;
    width: 100%;
    padding: 20px;
}

.app-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
}

.app-link {
    text-decoration: none;
    color: inherit;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.app-link:hover {
    text-decoration: none;
    color: inherit;
    transform: translateY(-2px);
}

.app-icon {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.app-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.app-icon:hover::before {
    opacity: 1;
}

.app-icon:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.app-icon i {
    font-size: 32px;
    color: white;
    z-index: 1;
}

.app-name {
    font-size: 14px;
    font-weight: 500;
    color: #333;
    margin-top: 5px;
    white-space: nowrap;
}

.app-info {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 18px;
    height: 18px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.app-item:hover .app-info {
    opacity: 1;
}

.app-info i {
    font-size: 10px;
    color: white;
}

/* Unique App Icon Colors with Beautiful Gradients */
.products-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.pos-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
.accounting-icon { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
.expenses-icon { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); }
.manufacturing-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.receipts-icon { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
.analytics-icon { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
.reviews-icon { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
.payments-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.settings-icon { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }

/* Responsive Design */
@media (max-width: 768px) {
    .app-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        padding: 10px;
    }
    
    .app-icon {
        width: 70px;
        height: 70px;
    }
    
    .app-icon i {
        font-size: 28px;
    }
    
    .app-name {
        font-size: 12px;
    }
}

@media (max-width: 480px) {
    .app-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .app-icon {
        width: 60px;
        height: 60px;
    }
    
    .app-icon i {
        font-size: 24px;
    }
    
    .app-name {
        font-size: 10px;
    }
}
</style>
{% endblock %}
